Object.defineProperty(exports,"__esModule",{value:!0});var e=require("graphql"),r=require("./25214b36.min.js"),t=require("wonka"),n=(e,r)=>{if(Array.isArray(e))for(var t of e)n(t,r);else if("object"==typeof e&&null!==e)for(var a in e)"__typename"===a&&"string"==typeof e[a]?r.add(e[a]):n(e[a],r);return r},a=r=>{if(!r.selectionSet)return r;for(var t of r.selectionSet.selections)if(t.kind===e.Kind.FIELD&&"__typename"===t.name.value&&!t.alias)return r;return{...r,selectionSet:{...r.selectionSet,selections:[...r.selectionSet.selections,{kind:e.Kind.FIELD,name:{kind:e.Kind.NAME,value:"__typename"}}]}}},o=new Map,i=t=>{var n=r.keyDocument(t),i=o.get(n.__key);return i||(i=e.visit(n,{Field:a,InlineFragment:a}),Object.defineProperty(i,"__key",{value:n.__key,enumerable:!1}),o.set(n.__key,i)),i},s=(e,r)=>{if(e&&"object"==typeof e){if(Array.isArray(e))return e.map((e=>s(e)));if(e&&"object"==typeof e&&(r||"__typename"in e)){var t={};for(var n in e)"__typename"===n?Object.defineProperty(t,"__typename",{enumerable:!1,value:e.__typename}):t[n]=s(e[n]);return t}return e}return e};function u(e){return e.toPromise=()=>new Promise((r=>{var n=t.subscribe((e=>{e.stale||e.hasNext||Promise.resolve().then((()=>{n.unsubscribe(),r(e)}))}))(e)})),e}function c(e,r,t){return t||(t=r.context),{key:r.key,query:r.query,variables:r.variables,kind:e,context:t}}var p=(e,r)=>c(e.kind,e,{...e.context,meta:{...e.context.meta,...r}}),l=()=>{},y=(t,n,a)=>{for(var o of a)if(o.kind===e.Kind.FRAGMENT_DEFINITION){var i=o.name.value,s=r.stringifyDocument(o);t.has(i)||(t.set(i,s),n.push(o))}else n.push(o)},d=({kind:e})=>"mutation"!==e&&"query"!==e,k=({forward:e,client:r})=>{var a=new Map,o=new Map,s=e=>{var r=c(e.kind,e);return r.query=i(e.query),r},u=e=>{var{key:r,kind:t,context:{requestPolicy:n}}=e;return"query"===t&&"network-only"!==n&&("cache-only"===n||a.has(r))};return i=>{var c=t.share(i),l=t.map((e=>{var t=a.get(e.key),n={...t,operation:p(e,{cacheOutcome:t?"hit":"miss"})};return"cache-and-network"===e.context.requestPolicy&&(n.stale=!0,f(r,e)),n}))(t.filter((e=>!d(e)&&u(e)))(c)),y=t.tap((e=>{var{operation:t}=e;if(t){var i=(e=>[...n(e,new Set)])(e.data).concat(t.context.additionalTypenames||[]);if("mutation"===e.operation.kind){for(var s=new Set,u=0;u<i.length;u++){var c=i[u],p=o.get(c);for(var l of(p||o.set(c,p=new Set),p.values()))s.add(l);p.clear()}for(var y of s.values())a.has(y)&&(t=a.get(y).operation,a.delete(y),f(r,t))}else if("query"===t.kind&&e.data){a.set(t.key,e);for(var d=0;d<i.length;d++){var k=i[d],m=o.get(k);m||o.set(k,m=new Set),m.add(t.key)}}}}))(e(t.filter((e=>"query"!==e.kind||"cache-only"!==e.context.requestPolicy))(t.map((e=>p(e,{cacheOutcome:"miss"})))(t.merge([t.map(s)(t.filter((e=>!d(e)&&!u(e)))(c)),t.filter((e=>d(e)))(c)])))));return t.merge([l,y])}},f=(e,r)=>e.reexecuteOperation(c(r.kind,r,{...r.context,requestPolicy:"network-only"})),m=new Set,h=({forward:e})=>{var r=new Set,n=e=>{var{key:t,kind:n}=e;if("teardown"===n||"mutation"===n)return r.delete(t),!0;var a=r.has(t);return r.add(t),!a},a=({operation:e,hasNext:t})=>{t||r.delete(e.key)};return r=>{var o=t.filter(n)(r);return t.tap(a)(e(o))}},x=({forward:e})=>n=>{var a=t.share(n),o=t.mergeMap((e=>{var{key:n}=e,o=r.makeFetchBody(e),i=r.makeFetchURL(e,o),s=r.makeFetchOptions(e,o);return t.takeUntil(t.filter((e=>"teardown"===e.kind&&e.key===n))(a))(r.makeFetchSource(e,i,s))}))(t.filter((e=>"query"===e.kind||"mutation"===e.kind))(a)),i=e(t.filter((e=>"query"!==e.kind&&"mutation"!==e.kind))(a));return t.merge([o,i])},v=({})=>e=>t.filter((()=>!1))(t.tap((e=>{}))(e)),g=v({dispatchDebug:l}),b=e=>({client:r,forward:t})=>e.reduceRight(((e,t)=>t({client:r,forward:e,dispatchDebug(e){}})),t),q=({onOperation:e,onResult:r,onError:n})=>({forward:a})=>o=>t.mergeMap((e=>{n&&e.error&&n(e.error,e.operation);var a=r&&r(e)||e;return"then"in a?t.fromPromise(a):t.fromValue(a)}))(a(t.mergeMap((r=>{var n=e&&e(r)||r;return"then"in n?t.fromPromise(n):t.fromValue(n)}))(o))),w=[h,k,x],E=function e(n){var a=0,o=new Map,i=new Map,p=[],y={url:n.url,fetchOptions:n.fetchOptions,fetch:n.fetch,preferGetMethod:!!n.preferGetMethod,requestPolicy:n.requestPolicy||"cache-first"},{source:d,next:k}=t.makeSubject(),f=!1;function m(e){if(e&&k(e),!f){for(f=!0;f&&(e=p.shift());)k(e);f=!1}}var h=e=>{var r=t.filter((r=>r.operation.kind===e.kind&&r.operation.key===e.key&&(!r.operation.context._instance||r.operation.context._instance===e.context._instance)))(O);return n.maskTypename&&(r=t.map((e=>({...e,data:s(e.data,!0)})))(r)),"mutation"===e.kind?t.take(1)(t.onStart((()=>k(e)))(r)):t.share(t.onEnd((()=>{o.delete(e.key),i.delete(e.key);for(var r=p.length-1;r>=0;r--)p[r].key===e.key&&p.splice(r,1);k(c("teardown",e,e.context))}))(t.onPush((r=>{o.set(e.key,r)}))(t.switchMap((r=>"query"!==e.kind||r.stale?t.fromValue(r):t.merge([t.fromValue(r),t.map((()=>({...r,stale:!0})))(t.take(1)(t.filter((r=>"query"===r.kind&&r.key===e.key&&"cache-only"!==r.context.requestPolicy))(d)))])))(t.takeUntil(t.filter((r=>"teardown"===r.kind&&r.key===e.key))(d))(r)))))},x=this instanceof e?this:Object.create(e.prototype),g=Object.assign(x,{suspense:!!n.suspense,operations$:d,reexecuteOperation(e){("mutation"===e.kind||i.has(e.key))&&(p.push(e),Promise.resolve().then(m))},createRequestOperation:(e,t,n)=>(n||(n={}),r.getOperationType(t.query),c(e,t,{_instance:"mutation"===e?a=a+1|0:void 0,...y,...n,requestPolicy:n.requestPolicy||y.requestPolicy,suspense:n.suspense||!1!==n.suspense&&g.suspense})),executeRequestOperation:e=>"mutation"===e.kind?h(e):t.make((r=>{var n=i.get(e.key);n||i.set(e.key,n=h(e));var a="cache-and-network"===e.context.requestPolicy||"network-only"===e.context.requestPolicy;return t.subscribe(r.next)(t.onEnd((()=>{f=!1,r.complete()}))(t.onStart((()=>{var t=o.get(e.key);if("subscription"===e.kind)return m(e);a&&m(e),null!=t&&t===o.get(e.key)?r.next(a?{...t,stale:!0}:t):a||m(e)}))(n))).unsubscribe})),executeQuery(e,r){var t=g.createRequestOperation("query",e,r);return g.executeRequestOperation(t)},executeSubscription(e,r){var t=g.createRequestOperation("subscription",e,r);return g.executeRequestOperation(t)},executeMutation(e,r){var t=g.createRequestOperation("mutation",e,r);return g.executeRequestOperation(t)},query:(e,t,n)=>(n&&"boolean"==typeof n.suspense||(n={...n,suspense:!1}),u(g.executeQuery(r.createRequest(e,t),n))),readQuery(e,r,n){var a=null;return t.subscribe((e=>{a=e}))(g.query(e,r,n)).unsubscribe(),a},subscription:(e,t,n)=>g.executeSubscription(r.createRequest(e,t),n),mutation:(e,t,n)=>u(g.executeMutation(r.createRequest(e,t),n))}),q=l,E=b(void 0!==n.exchanges?n.exchanges:w),O=t.share(E({client:g,dispatchDebug:q,forward:v({dispatchDebug:q})})(d));return t.publish(O),g},O=E;exports.CombinedError=r.CombinedError,exports.createRequest=r.createRequest,exports.getOperationName=r.getOperationName,exports.makeErrorResult=r.makeErrorResult,exports.makeResult=r.makeResult,exports.mergeResultPatch=r.mergeResultPatch,exports.stringifyVariables=r.stringifyVariables,exports.Client=E,exports.cacheExchange=k,exports.composeExchanges=b,exports.createClient=O,exports.debugExchange=({forward:e})=>r=>e(r),exports.dedupExchange=h,exports.defaultExchanges=w,exports.errorExchange=q,exports.fallbackExchangeIO=g,exports.fetchExchange=x,exports.formatDocument=i,exports.gql=function(){for(var t=new Map,n=[],a=[],o=Array.isArray(arguments[0])?arguments[0][0]:arguments[0]||"",i=1;i<arguments.length;i++){var s=arguments[i];s&&s.definitions?a.push(...s.definitions):o+=s,o+=arguments[0][i]}return y(t,n,r.keyDocument(o).definitions),y(t,n,a),r.keyDocument({kind:e.Kind.DOCUMENT,definitions:n})},exports.makeOperation=c,exports.mapExchange=q,exports.maskTypename=s,exports.ssrExchange=(e={})=>{var n=!!e.staleWhileRevalidate,a=!!e.includeExtensions,o={},i=[],s=e=>{i.push(e.operation.key),1===i.length&&Promise.resolve().then((()=>{for(var e;e=i.shift();)o[e]=null}))},u=({client:i,forward:u})=>c=>{var l=e&&"boolean"==typeof e.isClient?!!e.isClient:!i.suspense,y=t.share(c),d=u(t.filter((e=>!o[e.key]||!!o[e.key].hasNext||"network-only"===e.context.requestPolicy))(y)),k=t.map((e=>{var t=((e,t,n)=>({operation:e,data:t.data?JSON.parse(t.data):void 0,extensions:n&&t.extensions?JSON.parse(t.extensions):void 0,error:t.error?new r.CombinedError({networkError:t.error.networkError?new Error(t.error.networkError):void 0,graphQLErrors:t.error.graphQLErrors}):void 0,hasNext:t.hasNext}))(e,o[e.key],a);return n&&!m.has(e.key)&&(t.stale=!0,m.add(e.key),f(i,e)),{...t,operation:p(e,{cacheOutcome:"hit"})}}))(t.filter((e=>!!o[e.key]&&"network-only"!==e.context.requestPolicy))(y));return l?k=t.tap(s)(k):d=t.tap((e=>{var{operation:r}=e;if("mutation"!==r.kind){var t=(({hasNext:e,data:r,extensions:t,error:n},a)=>{var o={};return void 0!==r&&(o.data=JSON.stringify(r)),a&&void 0!==t&&(o.extensions=JSON.stringify(t)),e&&(o.hasNext=!0),n&&(o.error={graphQLErrors:n.graphQLErrors.map((e=>e.path||e.extensions?{message:e.message,path:e.path,extensions:e.extensions}:e.message))},n.networkError&&(o.error.networkError=""+n.networkError)),o})(e,a);o[r.key]=t}}))(d),t.merge([d,k])};return u.restoreData=e=>{for(var r in e)null!==o[r]&&(o[r]=e[r])},u.extractData=()=>{var e={};for(var r in o)null!=o[r]&&(e[r]=o[r]);return e},e&&e.initialState&&u.restoreData(e.initialState),u},exports.subscriptionExchange=({forwardSubscription:e,enableAllOperations:n,isSubscriptionOperation:a})=>({client:o,forward:i})=>{var s=a||(e=>{var{kind:r}=e;return"subscription"===r||!!n&&("query"===r||"mutation"===r)});return n=>{var a=t.share(n),u=t.mergeMap((n=>{var{key:i}=n,s=t.filter((e=>"teardown"===e.kind&&e.key===i))(a);return t.takeUntil(s)((n=>{var a=e({key:n.key.toString(36),query:r.stringifyDocument(n.query),variables:n.variables,context:{...n.context}});return t.make((({next:e,complete:t})=>{var i,s=!1;return Promise.resolve().then((()=>{s||(i=a.subscribe({next:t=>e(r.makeResult(n,t)),error:t=>e(r.makeErrorResult(n,t)),complete:()=>{s||(s=!0,"subscription"===n.kind&&o.reexecuteOperation(c("teardown",n,n.context)),t())}}))})),()=>{s=!0,i&&i.unsubscribe()}}))})(n))}))(t.filter(s)(a)),p=i(t.filter((e=>!s(e)))(a));return t.merge([u,p])}};
//# sourceMappingURL=urql-core.min.js.map
