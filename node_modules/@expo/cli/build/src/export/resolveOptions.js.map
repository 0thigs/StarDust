{"version":3,"sources":["../../../src/export/resolveOptions.ts"],"sourcesContent":["import { getConfig, Platform } from '@expo/config';\n\nimport { getPlatformBundlers, PlatformBundlers } from '../start/server/platformBundlers';\nimport { CommandError } from '../utils/errors';\n\nexport type Options = {\n  outputDir: string;\n  platforms: Platform[];\n  maxWorkers?: number;\n  dev: boolean;\n  clear: boolean;\n  dumpAssetmap: boolean;\n  dumpSourcemap: boolean;\n};\n\n/** Returns an array of platforms based on the input platform identifier and runtime constraints. */\nexport function resolvePlatformOption(\n  platformBundlers: PlatformBundlers,\n  platform: string = 'all'\n): Platform[] {\n  const platforms: Partial<PlatformBundlers> = Object.fromEntries(\n    Object.entries(platformBundlers).filter(([, bundler]) => bundler === 'metro')\n  );\n\n  if (!Object.keys(platforms).length) {\n    throw new CommandError(\n      `No platforms are configured to use the Metro bundler in the project Expo config.`\n    );\n  }\n\n  const assertPlatformBundler = (platform: Platform) => {\n    if (!platforms[platform]) {\n      throw new CommandError(\n        'BAD_ARGS',\n        `Platform \"${platform}\" is not configured to use the Metro bundler in the project Expo config.`\n      );\n    }\n  };\n\n  switch (platform) {\n    case 'ios':\n      assertPlatformBundler('ios');\n      return ['ios'];\n    case 'web':\n      assertPlatformBundler('web');\n      return ['web'];\n    case 'android':\n      assertPlatformBundler('android');\n      return ['android'];\n    case 'all':\n      return Object.keys(platforms) as Platform[];\n    default:\n      throw new CommandError(\n        `Unsupported platform \"${platform}\". Options are: ${Object.keys(platforms).join(',')}, all`\n      );\n  }\n}\n\nexport async function resolveOptionsAsync(projectRoot: string, args: any): Promise<Options> {\n  const { exp } = getConfig(projectRoot, { skipPlugins: true, skipSDKVersionRequirement: true });\n  const platformBundlers = getPlatformBundlers(exp);\n  const platforms: Platform[] = resolvePlatformOption(\n    platformBundlers,\n    args['--platform'] ?? 'all'\n  );\n\n  return {\n    outputDir: args['--output-dir'] ?? 'dist',\n    platforms,\n    clear: !!args['--clear'],\n    dev: !!args['--dev'],\n    maxWorkers: args['--max-workers'],\n    dumpAssetmap: !!args['--dump-assetmap'],\n    dumpSourcemap: !!args['--dump-sourcemap'],\n  };\n}\n"],"names":["resolvePlatformOption","resolveOptionsAsync","platformBundlers","platform","platforms","Object","fromEntries","entries","filter","bundler","keys","length","CommandError","assertPlatformBundler","join","projectRoot","args","exp","getConfig","skipPlugins","skipSDKVersionRequirement","getPlatformBundlers","outputDir","clear","dev","maxWorkers","dumpAssetmap","dumpSourcemap"],"mappings":"AAAA;;;;QAgBgBA,qBAAqB,GAArBA,qBAAqB;QA0CfC,mBAAmB,GAAnBA,mBAAmB;AA1DL,IAAA,OAAc,WAAd,cAAc,CAAA;AAEI,IAAA,iBAAkC,WAAlC,kCAAkC,CAAA;AAC3D,IAAA,OAAiB,WAAjB,iBAAiB,CAAA;AAavC,SAASD,qBAAqB,CACnCE,gBAAkC,EAClCC,SAAgB,GAAG,KAAK,EACZ;IACZ,MAAMC,SAAS,GAA8BC,MAAM,CAACC,WAAW,CAC7DD,MAAM,CAACE,OAAO,CAACL,gBAAgB,CAAC,CAACM,MAAM,CAAC,CAAC,GAAGC,OAAO,CAAC,GAAKA,OAAO,KAAK,OAAO;IAAA,CAAC,CAC9E,AAAC;IAEF,IAAI,CAACJ,MAAM,CAACK,IAAI,CAACN,SAAS,CAAC,CAACO,MAAM,EAAE;QAClC,MAAM,IAAIC,OAAY,aAAA,CACpB,CAAC,gFAAgF,CAAC,CACnF,CAAC;KACH;IAED,MAAMC,qBAAqB,GAAG,CAACV,QAAkB,GAAK;QACpD,IAAI,CAACC,SAAS,CAACD,QAAQ,CAAC,EAAE;YACxB,MAAM,IAAIS,OAAY,aAAA,CACpB,UAAU,EACV,CAAC,UAAU,EAAET,QAAQ,CAAC,wEAAwE,CAAC,CAChG,CAAC;SACH;KACF,AAAC;IAEF,OAAQA,SAAQ;QACd,KAAK,KAAK;YACRU,qBAAqB,CAAC,KAAK,CAAC,CAAC;YAC7B,OAAO;gBAAC,KAAK;aAAC,CAAC;QACjB,KAAK,KAAK;YACRA,qBAAqB,CAAC,KAAK,CAAC,CAAC;YAC7B,OAAO;gBAAC,KAAK;aAAC,CAAC;QACjB,KAAK,SAAS;YACZA,qBAAqB,CAAC,SAAS,CAAC,CAAC;YACjC,OAAO;gBAAC,SAAS;aAAC,CAAC;QACrB,KAAK,KAAK;YACR,OAAOR,MAAM,CAACK,IAAI,CAACN,SAAS,CAAC,CAAe;QAC9C;YACE,MAAM,IAAIQ,OAAY,aAAA,CACpB,CAAC,sBAAsB,EAAET,SAAQ,CAAC,gBAAgB,EAAEE,MAAM,CAACK,IAAI,CAACN,SAAS,CAAC,CAACU,IAAI,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,CAC5F,CAAC;KACL;CACF;AAEM,eAAeb,mBAAmB,CAACc,WAAmB,EAAEC,IAAS,EAAoB;IAC1F,MAAM,EAAEC,GAAG,CAAA,EAAE,GAAGC,CAAAA,GAAAA,OAAS,AAAqE,CAAA,UAArE,CAACH,WAAW,EAAE;QAAEI,WAAW,EAAE,IAAI;QAAEC,yBAAyB,EAAE,IAAI;KAAE,CAAC,AAAC;IAC/F,MAAMlB,gBAAgB,GAAGmB,CAAAA,GAAAA,iBAAmB,AAAK,CAAA,oBAAL,CAACJ,GAAG,CAAC,AAAC;QAGhDD,GAAkB;IAFpB,MAAMZ,SAAS,GAAeJ,qBAAqB,CACjDE,gBAAgB,EAChBc,CAAAA,GAAkB,GAAlBA,IAAI,CAAC,YAAY,CAAC,YAAlBA,GAAkB,GAAI,KAAK,CAC5B,AAAC;QAGWA,IAAoB;IADjC,OAAO;QACLM,SAAS,EAAEN,CAAAA,IAAoB,GAApBA,IAAI,CAAC,cAAc,CAAC,YAApBA,IAAoB,GAAI,MAAM;QACzCZ,SAAS;QACTmB,KAAK,EAAE,CAAC,CAACP,IAAI,CAAC,SAAS,CAAC;QACxBQ,GAAG,EAAE,CAAC,CAACR,IAAI,CAAC,OAAO,CAAC;QACpBS,UAAU,EAAET,IAAI,CAAC,eAAe,CAAC;QACjCU,YAAY,EAAE,CAAC,CAACV,IAAI,CAAC,iBAAiB,CAAC;QACvCW,aAAa,EAAE,CAAC,CAACX,IAAI,CAAC,kBAAkB,CAAC;KAC1C,CAAC;CACH"}