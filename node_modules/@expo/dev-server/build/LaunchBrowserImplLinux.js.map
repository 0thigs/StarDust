{"version":3,"file":"LaunchBrowserImplLinux.js","names":["LaunchBrowserImplLinux","LaunchBrowserTypes","CHROME","EDGE","getAppId","browserType","_appId","MAP","includes","appId","status","spawnAsync","stdio","Error","join","isSupportedBrowser","result","createTempBrowserDir","baseDirName","path","require","launchAsync","args","_process","open","openApp","arguments","close","kill","undefined"],"sources":["../src/LaunchBrowserImplLinux.ts"],"sourcesContent":["import spawnAsync from '@expo/spawn-async';\nimport { type ChildProcess } from 'child_process';\nimport open from 'open';\nimport path from 'path';\n\nimport {\n  LaunchBrowserTypes,\n  type LaunchBrowserImpl,\n  type LaunchBrowserInstance,\n} from './LaunchBrowser.types';\n\n/**\n * Browser implementation for Linux\n */\nexport default class LaunchBrowserImplLinux implements LaunchBrowserImpl, LaunchBrowserInstance {\n  private _appId: string | undefined;\n  private _process: ChildProcess | undefined;\n\n  MAP = {\n    [LaunchBrowserTypes.CHROME]: ['google-chrome', 'google-chrome-stable', 'chromium'],\n    [LaunchBrowserTypes.EDGE]: ['microsoft-edge', 'microsoft-edge-dev'],\n  };\n\n  /**\n   * On Linux, the supported appId is an array, this function finds the available appId and caches it\n   */\n  private async getAppId(browserType: LaunchBrowserTypes): Promise<string> {\n    if (this._appId == null || !this.MAP[browserType].includes(this._appId)) {\n      for (const appId of this.MAP[browserType]) {\n        try {\n          const { status } = await spawnAsync('which', [appId], { stdio: 'ignore' });\n          if (status === 0) {\n            this._appId = appId;\n            break;\n          }\n        } catch {}\n      }\n    }\n\n    if (this._appId == null) {\n      throw new Error(\n        `Unable to find supported browser - tried[${this.MAP[browserType].join(', ')}]`\n      );\n    }\n\n    return this._appId;\n  }\n\n  async isSupportedBrowser(browserType: LaunchBrowserTypes): Promise<boolean> {\n    let result = false;\n    try {\n      await this.getAppId(browserType);\n      result = true;\n    } catch {\n      result = false;\n    }\n    return result;\n  }\n\n  async createTempBrowserDir(baseDirName: string) {\n    return path.join(require('temp-dir'), baseDirName);\n  }\n\n  async launchAsync(\n    browserType: LaunchBrowserTypes,\n    args: string[]\n  ): Promise<LaunchBrowserInstance> {\n    const appId = await this.getAppId(browserType);\n    this._process = await open.openApp(appId, { arguments: args });\n    return this;\n  }\n\n  async close(): Promise<void> {\n    this._process?.kill();\n    this._process = undefined;\n    this._appId = undefined;\n  }\n}\n"],"mappings":";;;;;;;AAAA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAEA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAEA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;;;;;AAMA;AACA;AACA;AACe,MAAMA,sBAAN,CAAiF;EAAA;IAAA;;IAAA;;IAAA,6BAIxF;MACJ,CAACC,mCAAA,CAAmBC,MAApB,GAA6B,CAAC,eAAD,EAAkB,sBAAlB,EAA0C,UAA1C,CADzB;MAEJ,CAACD,mCAAA,CAAmBE,IAApB,GAA2B,CAAC,gBAAD,EAAmB,oBAAnB;IAFvB,CAJwF;EAAA;;EAS9F;AACF;AACA;EACwB,MAARC,QAAQ,CAACC,WAAD,EAAmD;IACvE,IAAI,KAAKC,MAAL,IAAe,IAAf,IAAuB,CAAC,KAAKC,GAAL,CAASF,WAAT,EAAsBG,QAAtB,CAA+B,KAAKF,MAApC,CAA5B,EAAyE;MACvE,KAAK,MAAMG,KAAX,IAAoB,KAAKF,GAAL,CAASF,WAAT,CAApB,EAA2C;QACzC,IAAI;UACF,MAAM;YAAEK;UAAF,IAAa,MAAM,IAAAC,qBAAA,EAAW,OAAX,EAAoB,CAACF,KAAD,CAApB,EAA6B;YAAEG,KAAK,EAAE;UAAT,CAA7B,CAAzB;;UACA,IAAIF,MAAM,KAAK,CAAf,EAAkB;YAChB,KAAKJ,MAAL,GAAcG,KAAd;YACA;UACD;QACF,CAND,CAME,MAAM,CAAE;MACX;IACF;;IAED,IAAI,KAAKH,MAAL,IAAe,IAAnB,EAAyB;MACvB,MAAM,IAAIO,KAAJ,CACH,4CAA2C,KAAKN,GAAL,CAASF,WAAT,EAAsBS,IAAtB,CAA2B,IAA3B,CAAiC,GADzE,CAAN;IAGD;;IAED,OAAO,KAAKR,MAAZ;EACD;;EAEuB,MAAlBS,kBAAkB,CAACV,WAAD,EAAoD;IAC1E,IAAIW,MAAM,GAAG,KAAb;;IACA,IAAI;MACF,MAAM,KAAKZ,QAAL,CAAcC,WAAd,CAAN;MACAW,MAAM,GAAG,IAAT;IACD,CAHD,CAGE,MAAM;MACNA,MAAM,GAAG,KAAT;IACD;;IACD,OAAOA,MAAP;EACD;;EAEyB,MAApBC,oBAAoB,CAACC,WAAD,EAAsB;IAC9C,OAAOC,eAAA,CAAKL,IAAL,CAAUM,OAAO,CAAC,UAAD,CAAjB,EAA+BF,WAA/B,CAAP;EACD;;EAEgB,MAAXG,WAAW,CACfhB,WADe,EAEfiB,IAFe,EAGiB;IAChC,MAAMb,KAAK,GAAG,MAAM,KAAKL,QAAL,CAAcC,WAAd,CAApB;IACA,KAAKkB,QAAL,GAAgB,MAAMC,eAAA,CAAKC,OAAL,CAAahB,KAAb,EAAoB;MAAEiB,SAAS,EAAEJ;IAAb,CAApB,CAAtB;IACA,OAAO,IAAP;EACD;;EAEU,MAALK,KAAK,GAAkB;IAAA;;IAC3B,uBAAKJ,QAAL,kEAAeK,IAAf;IACA,KAAKL,QAAL,GAAgBM,SAAhB;IACA,KAAKvB,MAAL,GAAcuB,SAAd;EACD;;AA9D6F"}