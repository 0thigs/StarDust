{"version":3,"file":"JsInspector.js","names":["openingBrowserInstance","openJsInspector","app","devtoolsFrontendRev","urlBase","ws","webSocketDebuggerUrl","replace","url","encodeURIComponent","closeJsInspector","launchBrowserAsync","close","queryInspectorAppAsync","metroServerOrigin","appId","apps","queryAllInspectorAppsAsync","find","description","resp","fetch","transformApps","json","filter","title","deviceIdToAppId","deviceId","id","split","map"],"sources":["../src/JsInspector.ts"],"sourcesContent":["import fetch from 'node-fetch';\n\nimport { launchBrowserAsync, type LaunchBrowserInstance } from './LaunchBrowser';\n\nexport interface MetroInspectorProxyApp {\n  description: string;\n  devtoolsFrontendUrl: string;\n  faviconUrl: string;\n  id: string;\n  title: string;\n  type: 'node';\n  vm: 'Hermes' | \"don't use\";\n  webSocketDebuggerUrl: string;\n}\n\nlet openingBrowserInstance: LaunchBrowserInstance | null = null;\n\nexport async function openJsInspector(app: MetroInspectorProxyApp) {\n  // To update devtoolsFrontendRev, find the full commit hash in the url:\n  // https://chromium.googlesource.com/chromium/src.git/+log/refs/tags/{CHROME_VERSION}/chrome/VERSION\n  //\n  // 1. Replace {CHROME_VERSION} with the target chrome version\n  // 2. Click the first log item in the webpage\n  // 3. The full commit hash is the desired revision\n  const devtoolsFrontendRev = 'd9568d04d7dd79269c5a655d7ada69650c5a8336'; // Chrome 100.0.4896.75\n\n  const urlBase = `https://chrome-devtools-frontend.appspot.com/serve_rev/@${devtoolsFrontendRev}/inspector.html`;\n  const ws = app.webSocketDebuggerUrl.replace(/^ws:\\/\\//, '');\n  const url = `${urlBase}?panel=sources&v8only=true&ws=${encodeURIComponent(ws)}`;\n  await closeJsInspector();\n  openingBrowserInstance = await launchBrowserAsync(url);\n}\n\nexport async function closeJsInspector() {\n  await openingBrowserInstance?.close();\n  openingBrowserInstance = null;\n}\n\nexport async function queryInspectorAppAsync(\n  metroServerOrigin: string,\n  appId: string\n): Promise<MetroInspectorProxyApp | null> {\n  const apps = await queryAllInspectorAppsAsync(metroServerOrigin);\n  return apps.find((app) => app.description === appId) ?? null;\n}\n\nexport async function queryAllInspectorAppsAsync(\n  metroServerOrigin: string\n): Promise<MetroInspectorProxyApp[]> {\n  const resp = await fetch(`${metroServerOrigin}/json/list`);\n  const apps: MetroInspectorProxyApp[] = transformApps(await resp.json());\n  // Only use targets with better reloading support\n  return apps.filter((app) => app.title === 'React Native Experimental (Improved Chrome Reloads)');\n}\n\n// The description of `React Native Experimental (Improved Chrome Reloads)` target is `don't use` from metro.\n// This function tries to transform the unmeaningful description to appId\nfunction transformApps(apps: MetroInspectorProxyApp[]): MetroInspectorProxyApp[] {\n  const deviceIdToAppId: Record<string, string> = {};\n\n  for (const app of apps) {\n    if (app.description !== \"don't use\") {\n      const deviceId = app.id.split('-')[0];\n      const appId = app.description;\n      deviceIdToAppId[deviceId] = appId;\n    }\n  }\n\n  return apps.map((app) => {\n    if (app.description === \"don't use\") {\n      const deviceId = app.id.split('-')[0];\n      app.description = deviceIdToAppId[deviceId] ?? app.description;\n    }\n    return app;\n  });\n}\n"],"mappings":";;;;;;;;;;AAAA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAEA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;;;AAaA,IAAIA,sBAAoD,GAAG,IAA3D;;AAEO,eAAeC,eAAf,CAA+BC,GAA/B,EAA4D;EACjE;EACA;EACA;EACA;EACA;EACA;EACA,MAAMC,mBAAmB,GAAG,0CAA5B,CAPiE,CAOO;;EAExE,MAAMC,OAAO,GAAI,2DAA0DD,mBAAoB,iBAA/F;EACA,MAAME,EAAE,GAAGH,GAAG,CAACI,oBAAJ,CAAyBC,OAAzB,CAAiC,UAAjC,EAA6C,EAA7C,CAAX;EACA,MAAMC,GAAG,GAAI,GAAEJ,OAAQ,iCAAgCK,kBAAkB,CAACJ,EAAD,CAAK,EAA9E;EACA,MAAMK,gBAAgB,EAAtB;EACAV,sBAAsB,GAAG,MAAM,IAAAW,mCAAA,EAAmBH,GAAnB,CAA/B;AACD;;AAEM,eAAeE,gBAAf,GAAkC;EAAA;;EACvC,gCAAMV,sBAAN,0DAAM,sBAAwBY,KAAxB,EAAN;EACAZ,sBAAsB,GAAG,IAAzB;AACD;;AAEM,eAAea,sBAAf,CACLC,iBADK,EAELC,KAFK,EAGmC;EAAA;;EACxC,MAAMC,IAAI,GAAG,MAAMC,0BAA0B,CAACH,iBAAD,CAA7C;EACA,qBAAOE,IAAI,CAACE,IAAL,CAAWhB,GAAD,IAASA,GAAG,CAACiB,WAAJ,KAAoBJ,KAAvC,CAAP,mDAAwD,IAAxD;AACD;;AAEM,eAAeE,0BAAf,CACLH,iBADK,EAE8B;EACnC,MAAMM,IAAI,GAAG,MAAM,IAAAC,oBAAA,EAAO,GAAEP,iBAAkB,YAA3B,CAAnB;EACA,MAAME,IAA8B,GAAGM,aAAa,CAAC,MAAMF,IAAI,CAACG,IAAL,EAAP,CAApD,CAFmC,CAGnC;;EACA,OAAOP,IAAI,CAACQ,MAAL,CAAatB,GAAD,IAASA,GAAG,CAACuB,KAAJ,KAAc,qDAAnC,CAAP;AACD,C,CAED;AACA;;;AACA,SAASH,aAAT,CAAuBN,IAAvB,EAAiF;EAC/E,MAAMU,eAAuC,GAAG,EAAhD;;EAEA,KAAK,MAAMxB,GAAX,IAAkBc,IAAlB,EAAwB;IACtB,IAAId,GAAG,CAACiB,WAAJ,KAAoB,WAAxB,EAAqC;MACnC,MAAMQ,QAAQ,GAAGzB,GAAG,CAAC0B,EAAJ,CAAOC,KAAP,CAAa,GAAb,EAAkB,CAAlB,CAAjB;MACA,MAAMd,KAAK,GAAGb,GAAG,CAACiB,WAAlB;MACAO,eAAe,CAACC,QAAD,CAAf,GAA4BZ,KAA5B;IACD;EACF;;EAED,OAAOC,IAAI,CAACc,GAAL,CAAU5B,GAAD,IAAS;IACvB,IAAIA,GAAG,CAACiB,WAAJ,KAAoB,WAAxB,EAAqC;MAAA;;MACnC,MAAMQ,QAAQ,GAAGzB,GAAG,CAAC0B,EAAJ,CAAOC,KAAP,CAAa,GAAb,EAAkB,CAAlB,CAAjB;MACA3B,GAAG,CAACiB,WAAJ,4BAAkBO,eAAe,CAACC,QAAD,CAAjC,yEAA+CzB,GAAG,CAACiB,WAAnD;IACD;;IACD,OAAOjB,GAAP;EACD,CANM,CAAP;AAOD"}