{"version":3,"file":"HermesBundler.js","names":["isEnableHermesManaged","expoConfig","platform","gteSdkVersion","android","jsEngine","ios","buildHermesBundleAsync","projectRoot","code","map","optimize","tempDir","path","join","os","tmpdir","process","pid","fs","ensureDir","tempBundleFile","tempSourcemapFile","writeFile","tempHbcFile","hermesCommand","importHermesCommandFromProject","args","push","spawnAsync","hbc","sourcemap","Promise","all","readFile","createHermesSourcemapAsync","remove","hermesMapFile","composeSourceMaps","importMetroSourceMapComposeSourceMapsFromProject","bundlerSourcemap","JSON","parse","hermesSourcemap","readJSON","stringify","parseGradleProperties","content","result","line","split","trim","startsWith","sepIndex","indexOf","key","substr","value","maybeThrowFromInconsistentEngineAsync","configFilePath","isHermesManaged","configFileName","basename","maybeInconsistentEngineAndroidAsync","Error","maybeInconsistentEngineIosAsync","appBuildGradlePath","existsSync","isPropsReference","search","isHermesBare","gradlePropertiesPath","props","podfilePath","hermesPropReferences","reduce","prev","curr","podfilePropertiesPath","parsePodfilePropertiesAsync","HERMES_MAGIC_HEADER","isHermesBytecodeBundleAsync","file","header","readHermesHeaderAsync","slice","toString","getHermesBytecodeBundleVersionAsync","readUInt32LE","fd","open","buffer","Buffer","alloc","read","close","expJson","sdkVersion","semver","gte"],"sources":["../src/HermesBundler.ts"],"sourcesContent":["import type { ExpoConfig, Platform } from '@expo/config';\nimport spawnAsync from '@expo/spawn-async';\nimport fs from 'fs-extra';\nimport os from 'os';\nimport path from 'path';\nimport process from 'process';\nimport semver from 'semver';\n\nimport {\n  importHermesCommandFromProject,\n  importMetroSourceMapComposeSourceMapsFromProject,\n} from './metro/importMetroFromProject';\n\nexport function isEnableHermesManaged(expoConfig: ExpoConfig, platform: Platform): boolean {\n  switch (platform) {\n    case 'android': {\n      if (!gteSdkVersion(expoConfig, '42.0.0')) {\n        // Hermes on Android is supported after SDK 42.\n        return false;\n      }\n      return (expoConfig.android?.jsEngine ?? expoConfig.jsEngine) === 'hermes';\n    }\n    case 'ios': {\n      if (!gteSdkVersion(expoConfig, '43.0.0')) {\n        // Hermes on iOS is supported after SDK 43.\n        return false;\n      }\n      return (expoConfig.ios?.jsEngine ?? expoConfig.jsEngine) === 'hermes';\n    }\n    default:\n      return false;\n  }\n}\n\ninterface HermesBundleOutput {\n  hbc: Uint8Array;\n  sourcemap: string;\n}\nexport async function buildHermesBundleAsync(\n  projectRoot: string,\n  code: string,\n  map: string,\n  optimize: boolean = false\n): Promise<HermesBundleOutput> {\n  const tempDir = path.join(os.tmpdir(), `expo-bundler-${process.pid}`);\n  await fs.ensureDir(tempDir);\n  try {\n    const tempBundleFile = path.join(tempDir, 'index.bundle');\n    const tempSourcemapFile = path.join(tempDir, 'index.bundle.map');\n    await fs.writeFile(tempBundleFile, code);\n    await fs.writeFile(tempSourcemapFile, map);\n\n    const tempHbcFile = path.join(tempDir, 'index.hbc');\n    const hermesCommand = importHermesCommandFromProject(projectRoot);\n    const args = ['-emit-binary', '-out', tempHbcFile, tempBundleFile, '-output-source-map'];\n    if (optimize) {\n      args.push('-O');\n    }\n    await spawnAsync(hermesCommand, args);\n\n    const [hbc, sourcemap] = await Promise.all([\n      fs.readFile(tempHbcFile),\n      createHermesSourcemapAsync(projectRoot, map, `${tempHbcFile}.map`),\n    ]);\n    return {\n      hbc,\n      sourcemap,\n    };\n  } finally {\n    await fs.remove(tempDir);\n  }\n}\n\nexport async function createHermesSourcemapAsync(\n  projectRoot: string,\n  sourcemap: string,\n  hermesMapFile: string\n): Promise<string> {\n  const composeSourceMaps = importMetroSourceMapComposeSourceMapsFromProject(projectRoot);\n  const bundlerSourcemap = JSON.parse(sourcemap);\n  const hermesSourcemap = await fs.readJSON(hermesMapFile);\n  return JSON.stringify(composeSourceMaps([bundlerSourcemap, hermesSourcemap]));\n}\n\nexport function parseGradleProperties(content: string): Record<string, string> {\n  const result: Record<string, string> = {};\n  for (let line of content.split('\\n')) {\n    line = line.trim();\n    if (!line || line.startsWith('#')) {\n      continue;\n    }\n\n    const sepIndex = line.indexOf('=');\n    const key = line.substr(0, sepIndex);\n    const value = line.substr(sepIndex + 1);\n    result[key] = value;\n  }\n  return result;\n}\n\nexport async function maybeThrowFromInconsistentEngineAsync(\n  projectRoot: string,\n  configFilePath: string,\n  platform: string,\n  isHermesManaged: boolean\n): Promise<void> {\n  const configFileName = path.basename(configFilePath);\n  if (\n    platform === 'android' &&\n    (await maybeInconsistentEngineAndroidAsync(projectRoot, isHermesManaged))\n  ) {\n    throw new Error(\n      `JavaScript engine configuration is inconsistent between ${configFileName} and Android native project.\\n` +\n        `In ${configFileName}: Hermes is ${isHermesManaged ? 'enabled' : 'not enabled'}\\n` +\n        `In Android native project: Hermes is ${isHermesManaged ? 'not enabled' : 'enabled'}\\n` +\n        `Please check the following files for inconsistencies:\\n` +\n        `  - ${configFilePath}\\n` +\n        `  - ${path.join(projectRoot, 'android', 'gradle.properties')}\\n` +\n        `  - ${path.join(projectRoot, 'android', 'app', 'build.gradle')}\\n` +\n        'Learn more: https://expo.fyi/hermes-android-config'\n    );\n  }\n\n  if (platform === 'ios' && (await maybeInconsistentEngineIosAsync(projectRoot, isHermesManaged))) {\n    throw new Error(\n      `JavaScript engine configuration is inconsistent between ${configFileName} and iOS native project.\\n` +\n        `In ${configFileName}: Hermes is ${isHermesManaged ? 'enabled' : 'not enabled'}\\n` +\n        `In iOS native project: Hermes is ${isHermesManaged ? 'not enabled' : 'enabled'}\\n` +\n        `Please check the following files for inconsistencies:\\n` +\n        `  - ${configFilePath}\\n` +\n        `  - ${path.join(projectRoot, 'ios', 'Podfile')}\\n` +\n        `  - ${path.join(projectRoot, 'ios', 'Podfile.properties.json')}\\n` +\n        'Learn more: https://expo.fyi/hermes-ios-config'\n    );\n  }\n}\n\nexport async function maybeInconsistentEngineAndroidAsync(\n  projectRoot: string,\n  isHermesManaged: boolean\n): Promise<boolean> {\n  // Trying best to check android native project if by chance to be consistent between app config\n\n  // Check android/app/build.gradle for \"enableHermes: true\"\n  const appBuildGradlePath = path.join(projectRoot, 'android', 'app', 'build.gradle');\n  if (fs.existsSync(appBuildGradlePath)) {\n    const content = await fs.readFile(appBuildGradlePath, 'utf8');\n    const isPropsReference =\n      content.search(\n        /^\\s*enableHermes:\\s*\\(findProperty\\('expo.jsEngine'\\) \\?: \"jsc\"\\) == \"hermes\",?\\s+/m\n      ) >= 0;\n    const isHermesBare = content.search(/^\\s*enableHermes:\\s*true,?\\s+/m) >= 0;\n    if (!isPropsReference && isHermesManaged !== isHermesBare) {\n      return true;\n    }\n  }\n\n  // Check gradle.properties from prebuild template\n  const gradlePropertiesPath = path.join(projectRoot, 'android', 'gradle.properties');\n  if (fs.existsSync(gradlePropertiesPath)) {\n    const props = parseGradleProperties(await fs.readFile(gradlePropertiesPath, 'utf8'));\n    const isHermesBare = props['expo.jsEngine'] === 'hermes';\n    if (isHermesManaged !== isHermesBare) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nexport async function maybeInconsistentEngineIosAsync(\n  projectRoot: string,\n  isHermesManaged: boolean\n): Promise<boolean> {\n  // Trying best to check ios native project if by chance to be consistent between app config\n\n  // Check ios/Podfile for \":hermes_enabled => true\"\n  const podfilePath = path.join(projectRoot, 'ios', 'Podfile');\n  if (fs.existsSync(podfilePath)) {\n    const content = await fs.readFile(podfilePath, 'utf8');\n    const hermesPropReferences = [\n      // sdk 45\n      /^\\s*:hermes_enabled\\s*=>\\s*flags\\[:hermes_enabled\\]\\s*\\|\\|\\s*podfile_properties\\['expo.jsEngine'\\]\\s*==\\s*'hermes',?/m,\n      // <= sdk 44\n      /^\\s*:hermes_enabled\\s*=>\\s*podfile_properties\\['expo.jsEngine'\\] == 'hermes',?\\s+/m,\n    ];\n    const isPropsReference = hermesPropReferences.reduce(\n      (prev, curr) => prev || content.search(curr) >= 0,\n      false\n    );\n    const isHermesBare = content.search(/^\\s*:hermes_enabled\\s*=>\\s*true,?\\s+/m) >= 0;\n    if (!isPropsReference && isHermesManaged !== isHermesBare) {\n      return true;\n    }\n  }\n\n  // Check Podfile.properties.json from prebuild template\n  const podfilePropertiesPath = path.join(projectRoot, 'ios', 'Podfile.properties.json');\n  if (fs.existsSync(podfilePropertiesPath)) {\n    const props = await parsePodfilePropertiesAsync(podfilePropertiesPath);\n    const isHermesBare = props['expo.jsEngine'] === 'hermes';\n    if (isHermesManaged !== isHermesBare) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n// https://github.com/facebook/hermes/blob/release-v0.5/include/hermes/BCGen/HBC/BytecodeFileFormat.h#L24-L25\nconst HERMES_MAGIC_HEADER = 'c61fbc03c103191f';\n\nexport async function isHermesBytecodeBundleAsync(file: string): Promise<boolean> {\n  const header = await readHermesHeaderAsync(file);\n  return header.slice(0, 8).toString('hex') === HERMES_MAGIC_HEADER;\n}\n\nexport async function getHermesBytecodeBundleVersionAsync(file: string): Promise<number> {\n  const header = await readHermesHeaderAsync(file);\n  if (header.slice(0, 8).toString('hex') !== HERMES_MAGIC_HEADER) {\n    throw new Error('Invalid hermes bundle file');\n  }\n  return header.readUInt32LE(8);\n}\n\nasync function readHermesHeaderAsync(file: string): Promise<Buffer> {\n  const fd = await fs.open(file, 'r');\n  const buffer = Buffer.alloc(12);\n  await fs.read(fd, buffer, 0, 12, null);\n  await fs.close(fd);\n  return buffer;\n}\n\n// Cloned from xdl/src/Versions.ts, we cannot use that because of circular dependency\nfunction gteSdkVersion(expJson: Pick<ExpoConfig, 'sdkVersion'>, sdkVersion: string): boolean {\n  if (!expJson.sdkVersion) {\n    return false;\n  }\n\n  if (expJson.sdkVersion === 'UNVERSIONED') {\n    return true;\n  }\n\n  try {\n    return semver.gte(expJson.sdkVersion, sdkVersion);\n  } catch {\n    throw new Error(`${expJson.sdkVersion} is not a valid version. Must be in the form of x.y.z`);\n  }\n}\n\nasync function parsePodfilePropertiesAsync(\n  podfilePropertiesPath: string\n): Promise<Record<string, string>> {\n  try {\n    return JSON.parse(await fs.readFile(podfilePropertiesPath, 'utf8'));\n  } catch {\n    return {};\n  }\n}\n"],"mappings":"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"}