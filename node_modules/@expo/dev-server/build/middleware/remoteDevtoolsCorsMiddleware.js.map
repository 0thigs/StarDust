{"version":3,"file":"remoteDevtoolsCorsMiddleware.js","names":["remoteDevtoolsCorsMiddleware","req","res","next","url","parseUrl","origin","headers","isValidOrigin","includes","pathname","endsWith","setHeader","bind","key","args"],"sources":["../../src/middleware/remoteDevtoolsCorsMiddleware.ts"],"sourcesContent":["import type { IncomingMessage, ServerResponse } from 'http';\nimport { parse as parseUrl } from 'url';\n\n// Middleware that accepts multiple Access-Control-Allow-Origin for processing *.map.\n// This is a hook middleware before metro processing *.map,\n// which originally allow only devtools://devtools\nexport function remoteDevtoolsCorsMiddleware(\n  req: IncomingMessage,\n  res: ServerResponse,\n  next: (err?: Error) => void\n) {\n  if (req.url) {\n    const url = parseUrl(req.url);\n    const origin = req.headers.origin;\n    const isValidOrigin =\n      origin &&\n      ['devtools://devtools', 'https://chrome-devtools-frontend.appspot.com'].includes(origin);\n    if (url.pathname?.endsWith('.map') && origin && isValidOrigin) {\n      res.setHeader('Access-Control-Allow-Origin', origin);\n\n      // Prevent metro overwrite Access-Control-Allow-Origin header\n      const setHeader = res.setHeader.bind(res);\n      res.setHeader = (key, ...args) => {\n        if (key !== 'Access-Control-Allow-Origin') {\n          setHeader(key, ...args);\n        }\n        return res;\n      };\n    }\n  }\n  next();\n}\n"],"mappings":";;;;;;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAEA;AACA;AACA;AACO,SAASA,4BAAT,CACLC,GADK,EAELC,GAFK,EAGLC,IAHK,EAIL;EACA,IAAIF,GAAG,CAACG,GAAR,EAAa;IAAA;;IACX,MAAMA,GAAG,GAAG,IAAAC,YAAA,EAASJ,GAAG,CAACG,GAAb,CAAZ;IACA,MAAME,MAAM,GAAGL,GAAG,CAACM,OAAJ,CAAYD,MAA3B;IACA,MAAME,aAAa,GACjBF,MAAM,IACN,CAAC,qBAAD,EAAwB,8CAAxB,EAAwEG,QAAxE,CAAiFH,MAAjF,CAFF;;IAGA,IAAI,iBAAAF,GAAG,CAACM,QAAJ,wDAAcC,QAAd,CAAuB,MAAvB,KAAkCL,MAAlC,IAA4CE,aAAhD,EAA+D;MAC7DN,GAAG,CAACU,SAAJ,CAAc,6BAAd,EAA6CN,MAA7C,EAD6D,CAG7D;;MACA,MAAMM,SAAS,GAAGV,GAAG,CAACU,SAAJ,CAAcC,IAAd,CAAmBX,GAAnB,CAAlB;;MACAA,GAAG,CAACU,SAAJ,GAAgB,CAACE,GAAD,EAAM,GAAGC,IAAT,KAAkB;QAChC,IAAID,GAAG,KAAK,6BAAZ,EAA2C;UACzCF,SAAS,CAACE,GAAD,EAAM,GAAGC,IAAT,CAAT;QACD;;QACD,OAAOb,GAAP;MACD,CALD;IAMD;EACF;;EACDC,IAAI;AACL"}